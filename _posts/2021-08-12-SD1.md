---
title: "서버 개발자 되는 법(1) - 서버 환경 구축"
excerpt: ""

categories:
  - Django
tags:
  - Django 기초
toc: true
toc_label: "목차"
published: false
---

# 서버 개발자가 하는 일

1. TR or API 만들기
2. 배치 만들기
3. DB 테이블 만들기

위의 3가지는 대부분의 서버 개발자들이 기본적으로 해야하는 작업이다.

# AWS 셋팅

우선 서버 개발을 위해 AWS에 회원가입을 한다. 메일마다 1년은 무료이기 때문에 기간이 끝나면 다른 메일을 이용하면 된다.

처음 시작을 하면 인스턴스가 비어있을텐데 `인스턴스 시작`을 누르면 단계가 진행된다.

1단계는 운영체제를 고르는 단계인데 우리는 Ubuntu 18.04 버전을 선택한다. 참고로 프리 티어라고 쓰여져 있지 않은 것은 유료이므로 조심하자!

2단계는 인스턴스 유형인데 서버 사양이라고 생각하면 된다. 어차피 프리티어는 하나밖에 못 고른다 ㅎㅎ

3, 4, 5단계는 가볍게 건너뛰고 6단계는 보안 관련인데 쉽게 말해 방화벽이다. HTTP는 아무나 들어와서 사용할 수 있는 포트이다.(80번 포트)

어떤 서비스냐에 따라서 사용자의 범위를 제한할 수 있다. 이 단계를 통해 IP로 이용자를 선별할 수 있다.

이제 시작하기를 누르면 키페어 선택 창이 뜨게 된다. SSH를 접속할 때 인증키가 필요한데 이를 통해 해당 키를 가지고 있는 사람만 들어올 수 있게 해준다. 생성된 키는 재다운로드가 되지 않기 때문에 꼭 저장하고 있어야 된다.

# 서버 접속

이제 접속을 해야하는데 터미널 접속을 도와주는 PuTTY라는 툴을 이용할 것이다. 이 툴에 본인의 IP 주소를 적고 저장을 한다.

<img src="https://drive.google.com/uc?export=view&id=1GiQF6CEJtTP39oa48izMZYxni8tcfgE1">

연결을 진행하려면 아까 다운받은 인증키가 있어야 하는데 확장자가 pem으로 되어있을 것이다. 이를 ppk로 변환을 해야하는데 이는 PuTTYgen을 이용해 변환할 수 있다. 변환을 완료했다면 SSH에 프라이빗 키를 등록해준다.

<img src="https://drive.google.com/uc?export=view&id=1QuGFxtyu4i086bVMFxRe5ghlAJ_t05bd">

그리고 오픈을 하면 터미널 창이 열리게 되고 로그인을 하라고 하는데 우리는 아무 아이디도 등록을 해주지 않았기 때문에 기본 루트 아이디인 ubuntu를 입력하면 접속이 된다.

<img src="https://drive.google.com/uc?export=view&id=1GiQF6CEJtTP39oa48izMZYxni8tcfgE1">

# 서버에 소스 올리기

이제 이 위에 본격적으로 소스를 올려야되는데 과정을 한 번 살펴보자.

## 과정

본인의 노트북(local)에서 작업을 진행하면 이를 git에 올린다. 그러면 git에 있는 소스를 서버에서 다운을 받고 실행을 하면 서버 가동이 된다.

<img src="https://drive.google.com/uc?export=view&id=1TbhDglE7zMlj4RF8FWEOcUtX17sSYbXt">

## 프로젝트 생성, git push

이제 로컬에서 Django를 실행시켜보자. 파이참을 이용해 django 프로젝트 셋팅을 마치고 소스를 올릴 git도 깃허브에 새로 생성한다.

git은 명령어로 해도 되지만 소스트리라는 툴을 이용하면 조금 더 편리하게 소스를 올릴 수 있다.(이 강의를 통해 처음 소스트리를 사용해봤는데 와우... 완전 신세계인거 같다. 너무 편하다. 더 깊은 사용법은 조금씩 더 찾아봐가면서 공부해야 될 거 같다.)

## 서버에서 pull

소스트리를 활용해서 깃허브에 소스를 올렸으면 이제 서버에 다시 이 소스들을 다운받아야한다. 기본적으로 서버에는 git이 깔려있다. 

서버 개발자들은 기본적인 명령어를 숙지하고 한 번씩 쳐보는 것이 굉장히 중요하다. 우선 server_dev로 서버 디렉토리를 생성하자. 

그리고 해당 디렉토리에 소스를 다운받자. 기본 git 소스 다운과 똑같은데 `git init`을 하고 `git remote add origin 주소`로 원격 저장소를 등록하고 `git pull origin main`으로 소스를 다운받는다. 

## 서버 환경 설정

서버에 파이썬이 안깔려있는 경우도 있고, 나 같이 3.6 버전이 깔려 있을 수도 있는데 버전을 3.8로 통일하기 위해 파이썬 3.8 버전을 설치한다. `sudo apt update`를 먼저 하고 `sudo apt python3`, `sudo apt python3-pip`를 통해 파이썬고 pip를 설치한다.

※ 리눅스에서 명령어 취소는 Ctrl+D이다!

가상환경도 설치해주어야 하는데 `sudo apt install virtualenv`로 서버에 설치를 하고 `pip3 install virtualenv`로 파이썬에도 설치를 해준다. 이제 `virtualenv venv --python=python3` 명령어를 입력하면 venv 폴더가 생기고 가상 환경이 만들어진다. 그리고 `source venv/bin/activate`를 통해 가상환경을 실행할 수 있다.

하지만 아직 djanog 패키지를 설치하지는 않았기 때문에 이를 설치해야 한다. 장고말고도 여러 패키지가 필요하기 때문에 이를 동기화 시키기 위해 requirements.txt를 이용한다.

이를 위해 로컬로 돌아가서 `pip freeze`를 입력하면 사용하고 있는 패키지들이 나온다. `pip freeze > requirements.txt` 명령어를 입력하면 사용하고 있는 모든 패키지가 requirements.txt 안으로 들어가게 된다.

이제 이것을 git에 다시 올리고 git에 올린 소스를 다시 서버가 pull하면 requirements.txt이 생긴다. 그리고 이것을 서버에서 `pip install -r requirements.txt` 명령어 입력하면 해당 패키지들을 자동으로 다운로드한다.

## 서버 띄우기

이렇게 모든 과정을 마치고 서버를 실행시켜보면 페이지를 찾을 수 없다고 뜬다!! 

여러가지 이유가 있는데 첫번째는 Django 내의 보안설정인데 이는 settings.py에 `ALLOWED_HOSTS = ['*']`를 추가하면 해결할 수 있다. 여기에 지정한 호스트만 접속할 수가 있고, `'localhost', '127.0.0.1', '[::1]'`가 디폴트로 정해져 있다.

두번째는 AWS에 방화벽 설정 때문이다. 이는 AWS의 보안 그룹/인바운드 규칙 편집에 들어가서 8000 포트를 추가하면 된다. 그리고 실행시킬 때 127.0.0.1:8000로 실행시키면 로컬에서만 실행이 되므로 0.0.0.0:8000로 실행한다. 이는 현재 로컬의 IP 주소의 8000번 포트로 서버가 구동된다는 뜻이다. 앞에 자신의 IP주소를 넣게 되면 장고 서버가 정상적으로 작동하게 된다.

# Reference

<a href="https://cholol.tistory.com/484?category=966420">서버개발자가 되는법 [1] - 서버 개발환경 셋팅, AWS EC2만들고 Django 프로젝트 실행해보기</a>